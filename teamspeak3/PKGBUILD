# Contributor: Slash <demodevil5[at]yahoo[dot]com>

pkgname=teamspeak3
pkgver=beta7
pkgrel=1
pkgdesc="TeamSpeak is software for quality voice communication via the Internet"
url="http://www.teamspeak.com/"
license=('custom')
depends=('qt')
arch=('i686' 'x86_64')
source=("http://ftp.4players.de/pub/hosted/ts3/releases/beta-7/TeamSpeak3-Client-linux_x86-3.0.0-${pkgver}.run" \
'teamspeak3.desktop' 'icon.xpm' 'teamspeak3.launcher')
md5sums=('60a62e5b45fd6cee1ab087e1bf894bbd'
         'be58a8798c5d1b7e95a89f6a6482db3e'
         '19f103384e4c1a0aafc8fed44de0c87b'
         '85d99798e7f8b1d0e082048d05eacce3')

if [ $CARCH == "x86_64" ]; then
    source[0]="http://ftp.4players.de/pub/hosted/ts3/releases/beta-7/TeamSpeak3-Client-linux_amd64-3.0.0-${pkgver}.run"
    md5sums[0]='0284fa0146832cbaca6a3711b3968c63'
fi

build() {
    cd $srcdir

    # Create Destination Directories
    install -d $pkgdir/{usr/bin/,opt/}

    if [ $CARCH == "i686" ]; then
        # Make Installer Executable
        chmod +x TeamSpeak3-Client-linux_x86-3.0.0-${pkgver}.run

        # Run Installer
        ./TeamSpeak3-Client-linux_x86-3.0.0-${pkgver}.run --noexec --target teamspeak3

        # Modify Client Launcher
        /bin/sed -i "s:TS3_BINARY:ts3client_linux_x86:" \
            $startdir/src/teamspeak3.launcher
    else
        # Make Installer Executable
        chmod +x TeamSpeak3-Client-linux_amd64-3.0.0-${pkgver}.run

        # Run Installer
        ./TeamSpeak3-Client-linux_amd64-3.0.0-${pkgver}.run --noexec --target teamspeak3

        # Modify Client Launcher
        /bin/sed -i "s:TS3_BINARY:ts3client_linux_amd64:" \
            $startdir/src/teamspeak3.launcher
    fi

    # Move Program Data to Package Directory
    mv $srcdir/teamspeak3/ $pkgdir/opt/

    # Install Desktop File
    install -D -m644 $srcdir/teamspeak3.desktop \
        $pkgdir/usr/share/applications/teamspeak3.desktop

    # Install Icon File
    install -D -m644 $srcdir/icon.xpm \
        $pkgdir/usr/share/pixmaps/teamspeak3.xpm

    # Install Custom License
    install -D -m644 $pkgdir/opt/teamspeak3/LICENSE \
        $pkgdir/usr/share/licenses/$pkgname/LICENSE

    # Install Client Launcher
    install -D -m755 $srcdir/teamspeak3.launcher \
        $pkgdir/usr/bin/teamspeak3
}
